var $event=$.event,$special=$event.special.debouncedresize={setup:function(){$(this).on('resize',$special.handler)},teardown:function(){$(this).off('resize',$special.handler)},handler:function(b,c){var d=this,e=arguments,a=function(){b.type='debouncedresize',$event.dispatch.apply(d,e)};resizeTimeout&&clearTimeout(resizeTimeout),c?a():resizeTimeout=setTimeout(a,$special.threshold)},threshold:250},BLANK='data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==',resizeTimeout,Grid;$.fn.imagesLoaded=function(c){var d=this,a=typeof $.Deferred=='function'?$.Deferred():0,j=typeof a.notify=='function',b=d.find('img').add(d.filter('img')),g=[],h=[],e=[];$.isPlainObject(c)&&$.each(c,function(b,d){b==='callback'?c=d:a&&a[b](d)});function i(){var f=$(h),g=$(e);a&&(e.length?a.reject(b,f,g):a.resolve(b)),typeof c=='function'&&c.call(d,b,f,g)}function f(c,d){if(c.src===BLANK||$.inArray(c,g)!==-1)return;g.push(c),d?e.push(c):h.push(c),$.data(c,'imagesLoaded',{isBroken:d,src:c.src}),j&&a.notifyWith($(c),[d,b,$(h),$(e)]),b.length===g.length&&(setTimeout(i),b.off('.imagesLoaded'))}return b.length?b.on('load.imagesLoaded error.imagesLoaded',function(a){f(a.target,a.type==='error')}).each(function(d,a){var c=a.src,b=$.data(a,'imagesLoaded');if(b&&b.src===c){f(a,b.isBroken);return}if(a.complete&&a.naturalWidth!==void 0){f(a,a.naturalWidth===0||a.naturalHeight===0);return}(a.readyState||a.complete)&&(a.src=BLANK,a.src=c)}):i(),a?a.promise(d):d},Grid=function(){var o=$('*#og-grid'),b=o.children('li'),e=-1,h=-1,f=0,j=10,k=$(window),c,u=$('html, body'),s={WebkitTransition:'webkitTransitionEnd',MozTransition:'transitionend',OTransition:'oTransitionEnd',msTransition:'MSTransitionEnd',transition:'transitionend'},i=s[Modernizr.prefixed('transition')],d=Modernizr.csstransitions,a={minHeight:500,speed:350,easing:'ease'};function r(b){a=$.extend(!0,{},a,b),o.imagesLoaded(function(){l(!0),m(),q()})}function v(a){b=b.add(a),a.each(function(){var a=$(this);a.data({offsetTop:a.offset().top,height:a.height()})}),n(a)}function l(a){b.each(function(){var b=$(this);b.data('offsetTop',b.offset().top),a&&b.data('height',b.height())})}function q(){n(b),k.on('debouncedresize',function(){f=0,h=-1,l(),m();var a=$.data(this,'preview');typeof a!='undefined'&&g()})}function n(a){a.on('click','span.og-close',function(){return g(),!1}).children('a').on('click',function(c){var b=$(this).parent();return e===Array.from(a).findIndex(a=>a==b[0])?g():t(b),!1})}function m(){c={width:k.width(),height:k.height()}}function t(b){var a=$.data(this,'preview'),c=b.data('offsetTop');if(f=0,typeof a!='undefined')if(h!==c)c>h&&(f=a.height),g();else return a.update(b),!1;h=c,a=$.data(this,'preview',new p(b)),a.open()}function g(){e=-1;var a=$.data(this,'preview');a.close(),$.removeData(this,'preview')}function p(a){this.$item=a,this.expandedIdx=Array.from(b).findIndex(a=>a==this.$item[0]),this.create(),this.update()}return p.prototype={create:function(){this.$title=$('<h3></h3>'),this.$description=$('<p></p>'),this.$href=$('<a href="#" class="button" target="_blank" rel="noreferrer">{{ .Site.Params.buttontext }}</a>'),this.$details=$('<div class="og-details"></div>').append(this.$title,this.$description,this.$href),this.$loading=$('<div class="og-loading"></div>'),this.$fullimage=$('<div class="og-fullimg"></div>').append(this.$loading),this.$closePreview=$('<span class="og-close"></span>'),this.$previewInner=$('<div class="og-expander-inner"></div>').append(this.$closePreview,this.$fullimage,this.$details),this.$previewEl=$('<div class="og-expander"></div>').append(this.$previewInner),this.$item.append(this.getEl()),d&&this.setTransition()},update:function(f){var g,d,c,a;f&&(this.$item=f),e!==-1&&(g=b.eq(e),g.removeClass('og-expanded'),this.$item.addClass('og-expanded'),this.positionPreview()),e=this.$item.index();function h(a){return a.replace(/_/g,'-').replace(/ /g,'-').replace(/:/g,'-').replace(/\\/g,'-').replace(/\//g,'-').replace(/[^a-zA-Z0-9\-]+/g,'').replace(/-{2,}/g,'-').toLowerCase()}d=this.$item.children('a'),c={href:d.attr('href'),largesrc:d.data('largesrc'),title:d.data('title'),description:$(`#description-${h(d.data('title'))}`).html(),buttontext:d.data('buttontext')},this.$title.html(c.title),this.$description.html(c.description),c.buttontext?this.$href.text(c.buttontext):this.$href.text('{{ .Site.Params.buttontext }}'),c.href?(this.$href.attr('href',c.href),this.$href.show()):this.$href.hide(),a=this,typeof a.$largeImg!='undefined'&&a.$largeImg.remove(),a.$fullimage.is(':visible')&&(this.$loading.show(),$('<img/>').on('load',function(){var b=$(this);b.attr('src')===a.$item.children('a').data('largesrc')&&(a.$loading.hide(),a.$fullimage.find('img').remove(),a.$largeImg=b.fadeIn(350),a.$fullimage.append(a.$largeImg))}).attr('src',c.largesrc))},open:function(){setTimeout($.proxy(function(){this.setHeights(),this.positionPreview()},this),25)},close:function(){var a=this,c=function(){d&&$(this).off(i),a.$item.removeClass('og-expanded'),a.$previewEl.remove()};return setTimeout($.proxy(function(){typeof this.$largeImg!='undefined'&&this.$largeImg.fadeOut('fast'),this.$previewEl.css('height',0);var a=b.eq(this.expandedIdx);a.css('height',a.data('height')).on(i,c),d||c.call()},this),25),!1},calcHeight:function(){var b=c.height-this.$item.data('height')-j,d=c.height;b<a.minHeight&&(b=a.minHeight,d=a.minHeight+this.$item.data('height')+j),this.height=b,this.itemHeight=d},setHeights:function(){var a=this,b=function(){d&&a.$item.off(i),a.$item.addClass('og-expanded')};this.calcHeight(),this.$previewEl.css('height',this.height),this.$item.css('height',this.itemHeight).on(i,b),d||b.call()},positionPreview:function(){var d=this.$item.data('offsetTop'),b=this.$previewEl.offset().top-f,e=this.height+this.$item.data('height')+j<=c.height?d:this.height<c.height?b-(c.height-this.height):b;u.animate({scrollTop:e},a.speed)},setTransition:function(){this.$previewEl.css('transition','height '+a.speed+'ms '+a.easing),this.$item.css('transition','height '+a.speed+'ms '+a.easing)},getEl:function(){return this.$previewEl}},{init:r,addItems:v}}(),$(function(){Grid.init()})